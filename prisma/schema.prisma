generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// ---------------------------------------------------------
//  USER
// ---------------------------------------------------------

model User {
  id         String        @id @default(auto()) @map("_id") @db.ObjectId
  name       String?
  email      String        @unique
  todos      Todo[]
  todoStreak TodoStreak?   // streak only for todos
  createdAt  DateTime      @default(now())
  notifications Notification[]
}

// ---------------------------------------------------------
//  ENUMS - TODO
// ---------------------------------------------------------

enum TodoStatus {
  PLAN
  PENDING
  DONE
  CANCELLED
  OVERDUE
  ARCHIVED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum RenewInterval {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
  CUSTOM
}

// ---------------------------------------------------------
//  TODO
// ---------------------------------------------------------

model Todo {
  id     String   @id @default(auto()) @map("_id") @db.ObjectId
  userId String   @db.ObjectId
  user   User     @relation(fields: [userId], references: [id])

  title       String
  description String?
  status      TodoStatus
  priority    Priority?
  tags        String[] @default([])

  dueDate     DateTime?
  dueTime     String?

  // Recurring
  renewStart   DateTime?
  renewInterval RenewInterval?
  renewEvery    Int?
  renewCustom   String?

  // Checklist
  checklist ChecklistItem[]

  // Completion tracking
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ---------------------------------------------------------
//  CHECKLIST ITEMS
// ---------------------------------------------------------

model ChecklistItem {
  id     String   @id @default(auto()) @map("_id") @db.ObjectId
  todoId String   @db.ObjectId
  todo   Todo     @relation(fields: [todoId], references: [id])

  text   String
  marked Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ---------------------------------------------------------
//  TODO STREAK
// ---------------------------------------------------------

model TodoStreak {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @unique @db.ObjectId
  user          User     @relation(fields: [userId], references: [id])

  count         Int      @default(0)
  longest       Int      @default(0)
  lastCompleted DateTime?
}

// ---------------------------------------------------------
//  NOTIFICATIONS
// ---------------------------------------------------------

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])

  message   String
  date      DateTime // when to notify
  read      Boolean  @default(false)

  createdAt DateTime @default(now())
}
